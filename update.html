<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>BOMB SURF 예약 수정</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body { font-family: 'Segoe UI', sans-serif; background: #fff; margin: 0; padding: 0; }
    .container { max-width: 450px; margin: 36px auto; background: #fff; padding: 28px 22px 20px 22px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.06);}
    .title-img { display: flex; justify-content: center; margin-bottom: 18px;}
    .title-img img { height: 48px; }
    h2 { text-align: center; font-size: 1.2em; margin-bottom: 18px; color: #1b1b1b;}
    form .row { display: flex; align-items: center; margin-bottom: 13px; }
    form .row label { width: 84px; font-weight: 500; color: #333; }
    form input, form select { flex:1; height: 33px; border: 1px solid #ddd; border-radius: 5px; font-size: 1em; padding: 0 8px; }
    form input[type="date"] { min-width: 125px; }
    form input[type="checkbox"] { flex: unset; margin: 0 7px 0 5px; width: 16px; height: 16px;}
    .options-row, .channels-row { display: flex; align-items: center; gap:14px; }
    .options-row label, .channels-row label { font-weight:400; width:auto; color:#555;}
    .memo-row { align-items: flex-start; }
    form textarea { width: 100%; min-height: 55px; border: 1px solid #ddd; border-radius: 5px; padding: 7px; font-size: 1em;}
    .btns { display: flex; gap: 10px; margin-top: 18px; }
    button {
      background: #0d6efd;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 11px 0;
      font-size: 1em;
      font-weight: bold;
      flex: 1;
      cursor: pointer;
      transition: background 0.13s;
    }
    button:hover { background: #189052;}
    .reset-btn { background: #adb5bd; }
    .reset-btn:hover { background: #868e96;}
    .cal-btn { background: #1d90ff; }
    .cal-btn:hover { background: #146fcc;}
    .del-btn { background: #ff5c5c; }
    .del-btn:hover { background: #b72222;}
  </style>
</head>
<body>
  <div class="container">
    <div class="title-img">
      <img src="title.jpg" alt="BOMB SURF">
    </div>
    <form id="resForm" autocomplete="off">
      <div class="row"><label>이름</label><input name="name" required></div>
      <div class="row"><label>인원</label><input name="people_count" type="number" min="1" required></div>
      <div class="row"><label>연락처</label><input name="phone" required></div>
      <div class="row"><label>날짜</label><input name="date" type="date" required></div>
      <div class="row"><label>시간</label>
        <select name="time" required>
          <option value="">선택</option>
          <option>09:00</option><option>09:30</option>
          <option>10:00</option><option>10:30</option>
          <option>11:00</option><option>11:30</option>
          <option>12:00</option><option>12:30</option>
          <option>13:00</option><option>13:30</option>
          <option>14:00</option><option>14:30</option>
          <option>15:00</option><option>15:30</option>
          <option>16:00</option><option>16:30</option>
          <option>17:00</option><option>17:30</option>
          <option>18:00</option><option>18:30</option>
        </select>
      </div>
      <div class="row">
        <label>프로그램</label>
        <select name="program" required>
          <option value="">선택</option>
          <option value="1시간">1시간</option>
          <option value="2시간">2시간</option>
          <option value="기타">기타</option>
        </select>
      </div>
      <div class="row options-row">
        <label>옵션</label>
        <label><input type="checkbox" name="lesson">강습</label>
        <label><input type="checkbox" name="board">보드</label>
        <label><input type="checkbox" name="suit">슈트</label>
        <label><input type="checkbox" name="shower">샤워</label>
      </div>
      <div class="row channels-row">
        <label>예약경로</label>
        <label><input type="radio" name="channel" value="네이버" required>네이버</label>
        <label><input type="radio" name="channel" value="전화">전화</label>
        <label><input type="radio" name="channel" value="기타">기타</label>
      </div>
      <div class="row"><label>금액</label><input name="amount" type="number" min="0"></div>
      <div class="row">
        <label>결제</label>
        <select name="payment" required>
          <option value="예정">결제예정</option>
          <option value="완료">결제완료</option>
          <option value="기타">기타</option>
        </select>
      </div>
      <div class="row memo-row">
        <label>메모</label>
        <textarea name="memo"></textarea>
      </div>
      <div class="btns">
        <button type="submit">수정 저장</button>
        <button type="button" class="reset-btn" onclick="window.location.reload()">초기화</button>
        <button type="button" class="cal-btn" onclick="location.href='calendar.html'">캘린더가기</button>
        <button type="button" class="del-btn" id="deleteBtn">삭제</button>
      </div>
    </form>
  </div>
  <script>
    const supabase = window.supabase.createClient(
      'https://xxmtxuhcdzidhrefrvwf.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh4bXR4dWhjZHppZGhyZWZydndmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQwODAyNTQsImV4cCI6MjA1OTY1NjI1NH0.TaCCDlJvKrif_pZY038Qkglip8h-Qqjp2w2GlKwvoVg'
    );
    // id 파라미터로 불러오기
    const params = new URLSearchParams(window.location.search);
    const id = params.get('id');
    const form = document.getElementById('resForm');
    async function load() {
      if(!id) { alert("잘못된 접근입니다"); return; }
      const { data, error } = await supabase.from('reservations').select('*').eq('id', id).single();
      if (error || !data) { alert("데이터 불러오기 실패"); return;}
      // 값 채우기
      form.name.value = data.name || '';
      form.people_count.value = data.people_count || '';
      form.phone.value = data.phone || '';
      form.date.value = data.date || '';
      form.time.value = data.time || '';
      form.program.value = data.program || '';
      form.lesson.checked = !!data.lesson;
      form.board.checked = !!data.board;
      form.suit.checked = !!data.suit;
      form.shower.checked = !!data.shower;
      // 채널(라디오)
      if(data.channel) {
        [...form.channel].forEach(radio => { radio.checked = (radio.value === data.channel); });
      }
      form.amount.value = data.amount || '';
      form.payment.value = data.payment || '';
      form.memo.value = data.memo || '';
    }
    load();

    // 저장
    form.onsubmit = async function(e) {
      e.preventDefault();
      const updated = {
        name: form.name.value,
people_count: Number(form.people_count.value),
phone: form.phone.value,
date: form.date.value,
time: form.time.value,
program: form.program.value,
lesson: form.lesson.checked,
board: form.board.checked,
suit: form.suit.checked,
shower: form.shower.checked,
channel: form.channel.value,
amount: form.amount.value ? Number(form.amount.value) : null,
payment: form.payment.value,
memo: form.memo.value
};
const { error } = await supabase.from('reservations').update(updated).eq('id', id);
if (error) {
alert('수정 실패: ' + error.message);
} else {
alert('수정이 완료되었습니다!');
window.location.href = 'calendar.html';
}
};
// 삭제
document.getElementById('deleteBtn').onclick = async function() {
if (!confirm('정말 삭제하시겠습니까?')) return;
const { error } = await supabase.from('reservations').delete().eq('id', id);
if (error) {
alert('삭제 실패: ' + error.message);
} else {
alert('삭제되었습니다!');
window.location.href = 'calendar.html';
}
};
</script>

</body> </html>
