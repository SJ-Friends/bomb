<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>BOMB SURF 예약 캘린더</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #fff;
      margin: 0; padding: 0;
      color: #222;
    }
    .container {
      max-width: 900px;
      margin: 48px auto 0 auto;
      background: #fff;
      padding: 20px 10px 20px 10px;
    }
    .title-img { display: flex; justify-content: center; margin-bottom: 12px;}
    .title-img img { height: 64px; }
    .calendar-header-wrap {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 14px;
      gap: 8px;
      flex-wrap: wrap;
    }
    .calendar-nav {
      display: flex; align-items: center; gap: 10px;
    }
    .calendar-nav-btn {
      background: #0d6efd;
      color: #fff;
      font-size: 1.15em;
      border: none;
      border-radius: 7px;
      padding: 7px 18px;
      cursor: pointer;
      font-weight: 600;
      transition: background 0.13s, box-shadow 0.13s;
      box-shadow: 0 2px 8px rgba(13,110,253,0.08);
    }
    .calendar-nav-btn:hover { background: #0b5ed7;}
    .month-label {
      font-size: 1.11em;
      font-weight: 700;
      color: #232323;
      min-width: 90px;
      text-align: center;
      letter-spacing: 0.01em;
    }
    .page-btns { display: flex; gap: 8px;}
    .add-btn {
      background: #26b66c;
      color: #fff;
      border: none;
      border-radius: 7px;
      padding: 8px 20px;
      font-size: 1em;
      font-weight:600;
      cursor: pointer;
      transition: background 0.11s;
      box-shadow: 0 2px 8px rgba(38,182,108,0.10);
    }
    .add-btn:hover { background: #189052;}
    .list-btn {
      background: #1d90ff;
      color: #fff;
      border: none;
      border-radius: 7px;
      padding: 8px 20px;
      font-size: 1em;
      font-weight:600;
      cursor: pointer;
      transition: background 0.11s;
      box-shadow: 0 2px 8px rgba(29,144,255,0.09);
    }
    .list-btn:hover { background: #146fcc;}
    .calendar-wrap { margin: 0 auto; }

    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px;
      margin-top: 6px;
      border: 1px solid #e0e0e0;
      background: #fff;
    }
    .cal-header {
      text-align: center;
      font-weight: 600;
      background: #f7faff;
      color: #1a3d6d;
      padding: 8px 0;
      border-bottom: 1px solid #e6e6e6;
    }
    .cal-cell {
      background: #fff;
      min-height: 65px;
      padding: 3px;
      font-size: 1em;
      position: relative;
      cursor:pointer;
      border: 1px solid #ededed;
      border-top: none;
      border-left: none;
      display:flex;
      flex-direction:column;
    }
    .cal-cell.today {
      border: 1.5px solid #ffe8a3 !important;
      background: #fffbe8 !important;
    }
    .cal-date {
      font-size: 0.98em;
      font-weight: 600;
      color: #212325;
      margin-bottom: 1px;
      text-align: right;
    }
    .res-list { margin: 0; padding: 0; list-style: none;}
    .res-item {
      background: #e9f7ef;
      border-radius: 3px;
      margin: 3px 0 0 0;
      padding: 5px 9px 4px 9px;
      font-weight: 500;
      color: #111;
      font-size: 0.75em;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
      cursor: pointer;
    }
    .res-item.lesson {
      background: #ffe5b4 !important;
    }
    .res-item:hover { background: #c1eed6;}
    .res-item.lesson:hover { background: #ffd488 !important;}
    .legend-bar {
      display: flex; align-items: center; gap: 16px;
      font-size: 0.75em;
      margin: 24px 0 8px 2px;
    }
    .legend-sample {
      display: inline-block;
      width: 36px; height: 20px;
      border-radius: 4px;
      margin-right: 6px;
      border: 1px solid #e3e3e3;
    }
    .legend-lesson { background: #ffe5b4; border: 1px solid #ffe5b4;}
    .legend-rental { background: #e9f7ef; border: 1px solid #e9f7ef;}
  </style>
</head>
<body>
  <div class="container">
    <div class="title-img">
      <img src="title.jpg" alt="BOMB SURF">
    </div>
    <div class="calendar-header-wrap">
      <div class="calendar-nav">
        <button class="calendar-nav-btn" id="prevMonth">&#8592;</button>
        <span class="month-label" id="monthLabel"></span>
        <button class="calendar-nav-btn" id="nextMonth">&#8594;</button>
      </div>
      <div class="page-btns">
        <button class="list-btn" onclick="location.href='list.html'">전체 예약 목록</button>
        <button class="add-btn" onclick="location.href='input.html'">+ 예약 입력</button>
      </div>
    </div>
    <div class="calendar-wrap">
      <div class="calendar" id="calendarGrid"></div>
    </div>
    <div class="legend-bar">
      <span><span class="legend-sample legend-lesson"></span>강습</span>
      <span><span class="legend-sample legend-rental"></span>렌탈</span>
    </div>
  </div>

  <script>
    const supabase = window.supabase.createClient(
      'https://xxmtxuhcdzidhrefrvwf.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh4bXR4dWhjZHppZGhyZWZydndmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQwODAyNTQsImV4cCI6MjA1OTY1NjI1NH0.TaCCDlJvKrif_pZY038Qkglip8h-Qqjp2w2GlKwvoVg'
    );

    let today = new Date();
    let currYear = today.getFullYear();
    let currMonth = today.getMonth();

    function fmtDate(d) { return d.toISOString().slice(0,10); }
    function z(n) { return n < 10 ? '0'+n : n; }
    const weekNames = ['일','월','화','수','목','금','토'];
    let reservations = [];

    async function renderCalendar() {
      document.getElementById('calendarGrid').innerHTML = '';

      const firstDay = new Date(currYear, currMonth, 1);
      const dayAfterLast = new Date(currYear, currMonth + 1, 1);
      const fromDate = fmtDate(firstDay);
      const toDate = fmtDate(dayAfterLast);

      const { data, error } = await supabase
        .from('reservations')
        .select('*')
        .gte('date', fromDate)
        .lt('date', toDate)
        .order('date', { ascending: true })
        .order('time', { ascending: true });

      reservations = data || [];

      weekNames.forEach(w => {
        const cell = document.createElement('div');
        cell.className = 'cal-header';
        cell.textContent = w;
        document.getElementById('calendarGrid').appendChild(cell);
      });

      const startDay = firstDay.getDay();
      const daysInMonth = new Date(currYear, currMonth + 1, 0).getDate();

      for (let i = 0; i < startDay; i++) {
        const cell = document.createElement('div');
        cell.className = 'cal-cell';
        cell.style.background = 'transparent';
        cell.style.cursor = 'default';
        document.getElementById('calendarGrid').appendChild(cell);
      }

      for (let d = 1; d <= daysInMonth; d++) {
        const dateStr = currYear + '-' + z(currMonth + 1) + '-' + z(d);
        const dayRes = reservations.filter(r => r.date === dateStr);
        const cell = document.createElement('div');
        cell.className = 'cal-cell' + (dateStr === fmtDate(today) ? ' today' : '');
        cell.setAttribute('data-date', dateStr);

        const dateDiv = document.createElement('div');
        dateDiv.className = 'cal-date';
        dateDiv.textContent = d;
        cell.appendChild(dateDiv);

        if (dayRes.length > 0) {
          const ul = document.createElement('ul');
          ul.className = 'res-list';
          dayRes.forEach(r => {
            const li = document.createElement('li');
            li.className = r.lesson ? 'res-item lesson' : 'res-item';
            li.textContent = r.name +
              (r.people_count ? `(${r.people_count})` : '') +
              (r.time ? ` ${r.time}` : '');
            li.onclick = (e) => {
              e.stopPropagation();
              window.location.href = `update.html?id=${r.id}`;
            };
            ul.appendChild(li);
          });
          cell.appendChild(ul);
        }

        cell.onclick = () => {
          window.location.href = `today.html?date=${dateStr}`;
        };

        document.getElementById('calendarGrid').appendChild(cell);
      }
    }

    document.getElementById('prevMonth').onclick = () => {
      if (currMonth === 0) { currMonth = 11; currYear--; }
      else currMonth--;
      updateMonthLabel(); renderCalendar();
    };

    document.getElementById('nextMonth').onclick = () => {
      if (currMonth === 11) { currMonth = 0; currYear++; }
      else currMonth++;
      updateMonthLabel(); renderCalendar();
    };

    function updateMonthLabel() {
      document.getElementById('monthLabel').textContent = `${currYear}년 ${z(currMonth + 1)}월`;
    }

    function init() {
      updateMonthLabel();
      renderCalendar();
    }

    init();
  </script>
</body>
</html>
